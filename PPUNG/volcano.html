<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTIMATE VOLCANO 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Arial', sans-serif; }
        #info { 
            position: absolute; top: 20px; width: 100%; text-align: center; 
            color: #ffaa00; pointer-events: none; 
            text-shadow: 0 0 10px #ff4500; z-index: 10; 
            letter-spacing: 2px;
        }
        h1 { margin: 0; font-size: 28px; font-weight: 800; }
        p { font-size: 14px; color: #ccc; margin-top: 5px; }
        .click-hint { color: white; font-weight: bold; animation: blink 1s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.5; } }
    </style>
    
    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="info">
        <h1>ğŸ”¥ ULTIMATE VOLCANO ğŸ”¥</h1>
        <p>ë§ˆìš°ìŠ¤ ë“œë˜ê·¸: íšŒì „ | íœ : ì¤Œ | <span class="click-hint">í™”ë©´ì„ í´ë¦­í•˜ì—¬ í­ë°œì‹œí‚¤ì„¸ìš”!</span></p>
    </div>

    <script>
        // --- 1. ìœ í‹¸ë¦¬í‹°: í…ìŠ¤ì²˜ ìƒì„±ê¸° (ì´ë¯¸ì§€ ë¡œë”© ì—†ì´ ë¹›ë‚˜ëŠ” ì…ì ë§Œë“¤ê¸°) ---
        function createGlowTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const context = canvas.getContext('2d');
            // ë°©ì‚¬í˜• ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ì› ê·¸ë¦¬ê¸°
            const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)'); // ì¤‘ì‹¬ì€ í°ìƒ‰
            gradient.addColorStop(0.4, 'rgba(255, 200, 100, 0.5)'); // ì¤‘ê°„ì€ ë…¸ë‘
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)'); // ëì€ íˆ¬ëª…
            context.fillStyle = gradient;
            context.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        }
        const particleTexture = createGlowTexture();

        // --- 2. ì”¬ ì„¤ì • ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505); // ê¹Šì€ ë°¤
        scene.fog = new THREE.FogExp2(0x050505, 0.02); // ì§™ì€ ì•ˆê°œë¡œ ë¶„ìœ„ê¸° ì—°ì¶œ

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 30, 60);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // ê³ í•´ìƒë„ ëŒ€ì‘
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true; // ìë™ íšŒì „ ì¶”ê°€
        controls.autoRotateSpeed = 0.5;

        // --- 3. ë°°ê²½ (ë³„) ë§Œë“¤ê¸° ---
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) {
            starPos[i] = (Math.random() - 0.5) * 300; // ë„“ê²Œ í¼ëœ¨ë¦¬ê¸°
        }
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5, transparent: true, opacity: 0.8 });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // --- 4. ì¡°ëª… ---
        const ambientLight = new THREE.AmbientLight(0x111111);
        scene.add(ambientLight);

        // ë‹¬ë¹›
        const moonLight = new THREE.DirectionalLight(0xaaccff, 0.5);
        moonLight.position.set(50, 100, 50);
        moonLight.castShadow = true;
        scene.add(moonLight);

        // í™”ì‚° ë‚´ë¶€ì˜ ê°•ë ¬í•œ ë¹› (ê¹œë¹¡ì„ íš¨ê³¼ìš©)
        const volcanoLight = new THREE.PointLight(0xff3300, 1, 100);
        volcanoLight.position.set(0, 15, 0);
        scene.add(volcanoLight);

        // --- 5. í™”ì‚° ëª¨ë¸ (Vertex Colors ì ìš©) ---
        const volcanoGroup = new THREE.Group();
        
        // ì‚° í˜•íƒœ
        const geometry = new THREE.CylinderGeometry(6, 35, 25, 32, 10); // ì„¸ê·¸ë¨¼íŠ¸ ëŠ˜ë ¤ì„œ ë¶€ë“œëŸ½ê²Œ
        const pos = geometry.attributes.position;
        const colors = [];
        const colorTop = new THREE.Color(0xff2200); // ë¶„í™”êµ¬: ë¶‰ì€ìƒ‰
        const colorBottom = new THREE.Color(0x1a1a1a); // ë°”ë‹¥: ê²€ì€ìƒ‰

        for (let i = 0; i < pos.count; i++) {
            const x = pos.getX(i);
            const y = pos.getY(i);
            const z = pos.getZ(i);
            
            // ë…¸ì´ì¦ˆë¥¼ ì¶”ê°€í•˜ì—¬ ìš¸í‰ë¶ˆí‰í•˜ê²Œ
            const noise = Math.random() * 1.5;
            const radiusEffect = 1 - (y + 12.5) / 25; // ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ í¼ì§
            
            if (y < 10) { // ë°”ë‹¥ ë¶€ë¶„ ë³€í˜•
                pos.setX(i, x + (Math.random()-0.5)*2 + x * 0.1 * noise);
                pos.setZ(i, z + (Math.random()-0.5)*2 + z * 0.1 * noise);
            }

            // ë†’ì´ì— ë”°ë¥¸ ìƒ‰ìƒ ì…íˆê¸° (Vertex Color)
            const mixFactor = (y + 12.5) / 25; // 0(ë°”ë‹¥) ~ 1(ê¼­ëŒ€ê¸°)
            const mixedColor = colorBottom.clone().lerp(colorTop, Math.pow(mixFactor, 3)); // ìœ„ìª½ë§Œ ë¶‰ê²Œ
            colors.push(mixedColor.r, mixedColor.g, mixedColor.b);
        }
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        geometry.computeVertexNormals();

        const material = new THREE.MeshStandardMaterial({
            vertexColors: true, // ì •ì  ìƒ‰ìƒ ì‚¬ìš©
            roughness: 0.8,
            flatShading: true
        });

        const volcano = new THREE.Mesh(geometry, material);
        volcano.position.y = 12.5;
        volcano.castShadow = true;
        volcano.receiveShadow = true;
        volcanoGroup.add(volcano);

        // ì§€ë©´
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(300, 300),
            new THREE.MeshStandardMaterial({ color: 0x151515, roughness: 1 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        scene.add(volcanoGroup);

        // --- 6. íŒŒí‹°í´ ì‹œìŠ¤í…œ í´ë˜ìŠ¤ ---
        const particles = [];
        const shockwaves = [];

        class Particle {
            constructor(type) {
                this.type = type; // 'lava', 'smoke', 'spark'
                
                // Three.js Spriteë¥¼ ì‚¬ìš©í•˜ì—¬ í•­ìƒ ì¹´ë©”ë¼ë¥¼ ë°”ë¼ë³´ëŠ” 2D ì´ë¯¸ì§€ íš¨ê³¼
                const mat = new THREE.SpriteMaterial({
                    map: particleTexture,
                    color: type === 'smoke' ? 0x555555 : (type === 'spark' ? 0xffff00 : 0xff4400),
                    transparent: true,
                    opacity: type === 'smoke' ? 0.4 : 1,
                    blending: THREE.AdditiveBlending // ë¹›ì´ ê²¹ì¹˜ë©´ ë” ë°ì•„ì§ (í•µì‹¬!)
                });
                
                this.mesh = new THREE.Sprite(mat);
                
                // ì´ˆê¸° ìœ„ì¹˜ (ë¶„í™”êµ¬)
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 4;
                this.mesh.position.set(
                    Math.cos(angle) * radius,
                    24, // ë¶„í™”êµ¬ ë†’ì´
                    Math.sin(angle) * radius
                );

                const sizeBase = type === 'smoke' ? 5 : (type === 'lava' ? 2 : 0.5);
                this.mesh.scale.set(sizeBase, sizeBase, 1);

                // ì†ë„ ì„¤ì •
                const explosionPower = Math.random();
                if (type === 'lava') {
                    this.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 15,
                        Math.random() * 30 + 20, // ë†’ì´ ì†Ÿêµ¬ì¹¨
                        (Math.random() - 0.5) * 15
                    );
                    this.gravity = 0.8;
                    this.drag = 0.96;
                } else if (type === 'smoke') {
                    this.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 10,
                        Math.random() * 10 + 5, 
                        (Math.random() - 0.5) * 10
                    );
                    this.gravity = -0.05; // ì—°ê¸°ëŠ” ìœ„ë¡œ ëœ¸
                    this.drag = 0.98;
                } else { // Spark
                    this.velocity = new THREE.Vector3(
                        (Math.random() - 0.5) * 40,
                        Math.random() * 40 + 10,
                        (Math.random() - 0.5) * 40
                    );
                    this.gravity = 0.5;
                    this.drag = 0.92;
                }

                scene.add(this.mesh);
                this.life = 1.0;
            }

            update() {
                this.life -= 0.01;
                
                // ë¬¼ë¦¬ ì—…ë°ì´íŠ¸
                this.mesh.position.add(this.velocity.clone().multiplyScalar(0.016)); // Delta time approx
                this.velocity.y -= this.gravity;
                this.velocity.multiplyScalar(this.drag);

                // íƒ€ì…ë³„ íŠ¹ìˆ˜ íš¨ê³¼
                if (this.type === 'smoke') {
                    this.mesh.scale.multiplyScalar(1.01); // ì—°ê¸°ëŠ” ì ì  ì»¤ì§
                    this.mesh.material.opacity = this.life * 0.4;
                } else if (this.type === 'lava') {
                    this.mesh.scale.multiplyScalar(0.98); // ìš©ì•”ì€ ì‹ìœ¼ë©´ì„œ ì‘ì•„ì§
                    // ìƒ‰ìƒ ë³€í™” (ë…¸ë‘ -> ë¹¨ê°• -> ê²€ì •)
                    const color = new THREE.Color();
                    color.setHSL(0.1 - (1 - this.life) * 0.1, 1, 0.5); 
                    this.mesh.material.color = color;
                }

                // ë°”ë‹¥ ì¶©ëŒ
                if (this.mesh.position.y < 0) {
                    this.mesh.position.y = 0;
                    this.velocity.y *= -0.5; // íŠ•ê¹€
                    this.velocity.x *= 0.8;
                    this.velocity.z *= 0.8;
                    
                    if (this.type === 'lava' && Math.abs(this.velocity.y) < 1) {
                        this.life -= 0.05; // ë°”ë‹¥ì— ë©ˆì¶”ë©´ ë¹¨ë¦¬ ì‚¬ë¼ì§
                    }
                }
            }

            dispose() {
                scene.remove(this.mesh);
                this.mesh.material.dispose();
            }
        }

        // ì¶©ê²©íŒŒ ë§ í´ë˜ìŠ¤
        class Shockwave {
            constructor() {
                const geometry = new THREE.RingGeometry(1, 2, 32);
                const material = new THREE.MeshBasicMaterial({ 
                    color: 0xffaa00, 
                    transparent: true, 
                    opacity: 0.8,
                    side: THREE.DoubleSide,
                    blending: THREE.AdditiveBlending
                });
                this.mesh = new THREE.Mesh(geometry, material);
                this.mesh.rotation.x = -Math.PI / 2;
                this.mesh.position.y = 25; // ë¶„í™”êµ¬ ìœ„ì¹˜
                scene.add(this.mesh);
                this.scale = 1;
            }
            update() {
                this.scale += 1.5;
                this.mesh.scale.set(this.scale, this.scale, 1);
                this.mesh.material.opacity -= 0.03;
            }
            isDead() { return this.mesh.material.opacity <= 0; }
            dispose() {
                scene.remove(this.mesh);
                this.mesh.geometry.dispose();
                this.mesh.material.dispose();
            }
        }

        // --- 7. ë©”ì¸ ë£¨í”„ ë° ì¸í„°ë™ì…˜ ---
        let shakeIntensity = 0;

        function animate() {
            requestAnimationFrame(animate);
            
            // 1) ì¡°ëª… ê¹œë¹¡ì„ (í™”ì‚° ìˆ¨ì‰¬ê¸°)
            const time = Date.now() * 0.005;
            volcanoLight.intensity = 2 + Math.sin(time) * 1 + Math.random();
            volcanoLight.color.setHSL(0.05 + Math.sin(time)*0.02, 1, 0.5);

            // 2) ìë™ íŒŒí‹°í´ (í‰ìƒì‹œ ì—°ê¸°)
            if (Math.random() < 0.3) particles.push(new Particle('smoke'));
            if (Math.random() < 0.05) particles.push(new Particle('lava'));

            // 3) íŒŒí‹°í´ ì—…ë°ì´íŠ¸
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                if (p.life <= 0) {
                    p.dispose();
                    particles.splice(i, 1);
                }
            }

            // 4) ì¶©ê²©íŒŒ ì—…ë°ì´íŠ¸
            for (let i = shockwaves.length - 1; i >= 0; i--) {
                const s = shockwaves[i];
                s.update();
                if (s.isDead()) {
                    s.dispose();
                    shockwaves.splice(i, 1);
                }
            }

            // 5) ì¹´ë©”ë¼ ì‰ì´í¬ íš¨ê³¼
            if (shakeIntensity > 0) {
                const rx = (Math.random() - 0.5) * shakeIntensity;
                const ry = (Math.random() - 0.5) * shakeIntensity;
                const rz = (Math.random() - 0.5) * shakeIntensity;
                camera.position.add(new THREE.Vector3(rx, ry, rz));
                shakeIntensity *= 0.9; // ê°ì‡ 
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // ì´ë²¤íŠ¸: í™”ë©´ ë¦¬ì‚¬ì´ì¦ˆ
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ì´ë²¤íŠ¸: í­ë°œ í´ë¦­
        function explode() {
            // ì¹´ë©”ë¼ í”ë“¤ë¦¼
            shakeIntensity = 2.0;
            
            // ì¶©ê²©íŒŒ ìƒì„±
            shockwaves.push(new Shockwave());

            // ëŒ€ëŸ‰ íŒŒí‹°í´ ìƒì„±
            for(let i=0; i<50; i++) particles.push(new Particle('lava'));
            for(let i=0; i<30; i++) particles.push(new Particle('smoke'));
            for(let i=0; i<40; i++) particles.push(new Particle('spark'));

            // í”Œë˜ì‹œ íš¨ê³¼ (ë°°ê²½ì´ ì ì‹œ ë°ì•„ì§)
            scene.background = new THREE.Color(0x331100);
            setTimeout(() => { scene.background = new THREE.Color(0x050505); }, 100);
        }

        window.addEventListener('pointerdown', explode);
        
        // ìŠ¤í˜ì´ìŠ¤ë°” ëˆŒëŸ¬ë„ í­ë°œ
        window.addEventListener('keydown', (e) => {
            if(e.code === 'Space') explode();
        });

        animate();
    </script>
</body>
</html>
