<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTIMATE VOLCANO 3D (ë°ì€ ë²„ì „)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1b1b2f; font-family: 'Arial', sans-serif; }
        #info { 
            position: absolute; top: 20px; width: 100%; text-align: center; 
            color: #ffaa00; pointer-events: none; 
            text-shadow: 0 0 10px #ff4500; z-index: 10; 
            letter-spacing: 2px;
        }
        h1 { margin: 0; font-size: 28px; font-weight: 800; }
        p { font-size: 14px; color: #ccc; margin-top: 5px; }
        .click-hint { color: white; font-weight: bold; animation: blink 1s infinite alternate; }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.5; } }
    </style>
    
    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="info">
        <h1>ğŸ”¥ VISIBLE VOLCANO ğŸ”¥</h1>
        <p>ë§ˆìš°ìŠ¤ ë“œë˜ê·¸: íšŒì „ | íœ : ì¤Œ | <span class="click-hint">í´ë¦­í•˜ì—¬ ëŒ€í­ë°œ!</span></p>
    </div>

    <script>
        // --- 1. ìœ í‹¸ë¦¬í‹°: í…ìŠ¤ì²˜ ìƒì„±ê¸° ---
        function createGlowTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const context = canvas.getContext('2d');
            const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.4, 'rgba(255, 200, 100, 0.5)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            context.fillStyle = gradient;
            context.fillRect(0, 0, 32, 32);
            return new THREE.CanvasTexture(canvas);
        }
        const particleTexture = createGlowTexture();

        // --- 2. ì”¬ ì„¤ì • (ë°°ê²½ ë°ê²Œ ìˆ˜ì •) ---
        const scene = new THREE.Scene();
        const bgColor = 0x1b1b2f; // ë°°ê²½: ì§™ì€ ë‚¨ìƒ‰ (ìƒˆë²½ ëŠë‚Œ)
        scene.background = new THREE.Color(bgColor);
        scene.fog = new THREE.FogExp2(bgColor, 0.015); // ì•ˆê°œë¥¼ ì¡°ê¸ˆ ê±·ì–´ëƒ„

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 30, 70); // ì¹´ë©”ë¼ë¥¼ ì¡°ê¸ˆ ë” ë’¤ë¡œ

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;

        // --- 3. ë°°ê²½ (ë³„) ---
        const starGeo = new THREE.BufferGeometry();
        const starCount = 1500;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) starPos[i] = (Math.random() - 0.5) * 400;
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7, transparent: true, opacity: 0.6 });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // --- 4. ì¡°ëª… (í•µì‹¬ ìˆ˜ì •: í™”ì‚°ì´ ì˜ ë³´ì´ë„ë¡ ë³€ê²½) ---
        
        // (1) í™˜ê²½ê´‘ (ê¸°ë³¸ ë°ê¸° í™•ë³´)
        const ambientLight = new THREE.AmbientLight(0x404040, 1.0); 
        scene.add(ambientLight);

        // (2) í—¤ë¯¸ìŠ¤í”¼ì–´ ë¼ì´íŠ¸ (í•˜ëŠ˜ìƒ‰ + ë•…ìƒ‰ ë°˜ì‚¬ê´‘) -> ì…ì²´ê° ê·¹ëŒ€í™”
        const hemiLight = new THREE.HemisphereLight(0xb1e1ff, 0xb97a20, 0.6); 
        scene.add(hemiLight);

        // (3) ë‹¬ë¹› (ì£¼ ê´‘ì›)
        const moonLight = new THREE.DirectionalLight(0xffffff, 0.8);
        moonLight.position.set(50, 80, 50);
        moonLight.castShadow = true;
        scene.add(moonLight);

        // (4) í™”ì‚° ë‚´ë¶€ ìš©ì•” ë¹›
        const volcanoLight = new THREE.PointLight(0xff3300, 1, 100);
        volcanoLight.position.set(0, 15, 0);
        scene.add(volcanoLight);

        // --- 5. í™”ì‚° ëª¨ë¸ ---
        const volcanoGroup = new THREE.Group();
        
        const geometry = new THREE.CylinderGeometry(6, 40, 25, 32, 10);
        const pos = geometry.attributes.position;
        const colors = [];
        const colorTop = new THREE.Color(0xff4422); // ë” ë°ì€ ë¶‰ì€ìƒ‰
        const colorBottom = new THREE.Color(0x4a4a4a); // ë°”ë‹¥ë„ ë„ˆë¬´ ì–´ë‘¡ì§€ ì•Šì€ íšŒìƒ‰

        for (let i = 0; i < pos.count; i++) {
            const x = pos.getX(i);
            const y = pos.getY(i);
            const z = pos.getZ(i);
            
            const noise = Math.random() * 2.0; // ìš¸í‰ë¶ˆí‰í•¨ ì¦ê°€
            if (y < 10) {
                pos.setX(i, x + (Math.random()-0.5)*3 + x * 0.05 * noise);
                pos.setZ(i, z + (Math.random()-0.5)*3 + z * 0.05 * noise);
            }

            const mixFactor = (y + 12.5) / 25;
            // ê·¸ë¼ë°ì´ì…˜ì„ ë” ë¶€ë“œëŸ½ê²Œ
            const mixedColor = colorBottom.clone().lerp(colorTop, Math.pow(mixFactor, 2));
            colors.push(mixedColor.r, mixedColor.g, mixedColor.b);
        }
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        geometry.computeVertexNormals();

        const material = new THREE.MeshStandardMaterial({
            vertexColors: true,
            roughness: 0.9, // ê±°ì¹œ ëŒ ëŠë‚Œ
            flatShading: true
        });

        const volcano = new THREE.Mesh(geometry, material);
        volcano.position.y = 12.5;
        volcano.castShadow = true;
        volcano.receiveShadow = true;
        volcanoGroup.add(volcano);

        // ì§€ë©´ (ì¡°ê¸ˆ ë” ë°ê²Œ)
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(400, 400),
            new THREE.MeshStandardMaterial({ color: 0x2a2a35, roughness: 1 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        scene.add(volcanoGroup);

        // --- 6. íŒŒí‹°í´ ì‹œìŠ¤í…œ (ë™ì¼) ---
        const particles = [];
        const shockwaves = [];

        class Particle {
            constructor(type) {
                this.type = type; 
                const mat = new THREE.SpriteMaterial({
                    map: particleTexture,
                    color: type === 'smoke' ? 0x888888 : (type === 'spark' ? 0xffffaa : 0xff5500), // ì—°ê¸° ìƒ‰ ë°ê²Œ
                    transparent: true,
                    opacity: type === 'smoke' ? 0.3 : 1,
                    blending: THREE.AdditiveBlending
                });
                this.mesh = new THREE.Sprite(mat);
                
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 5;
                this.mesh.position.set(Math.cos(angle) * radius, 24, Math.sin(angle) * radius);

                const sizeBase = type === 'smoke' ? 6 : (type === 'lava' ? 2.5 : 0.6);
                this.mesh.scale.set(sizeBase, sizeBase, 1);

                const force = Math.random();
                if (type === 'lava') {
                    this.velocity = new THREE.Vector3((Math.random()-0.5)*15, Math.random()*30+20, (Math.random()-0.5)*15);
                    this.gravity = 0.8; this.drag = 0.96;
                } else if (type === 'smoke') {
                    this.velocity = new THREE.Vector3((Math.random()-0.5)*12, Math.random()*10+5, (Math.random()-0.5)*12);
                    this.gravity = -0.05; this.drag = 0.98;
                } else { 
                    this.velocity = new THREE.Vector3((Math.random()-0.5)*45, Math.random()*40+10, (Math.random()-0.5)*45);
                    this.gravity = 0.5; this.drag = 0.92;
                }
                scene.add(this.mesh);
                this.life = 1.0;
            }
            update() {
                this.life -= 0.01;
                this.mesh.position.add(this.velocity.clone().multiplyScalar(0.016));
                this.velocity.y -= this.gravity;
                this.velocity.multiplyScalar(this.drag);

                if (this.type === 'smoke') {
                    this.mesh.scale.multiplyScalar(1.01);
                    this.mesh.material.opacity = this.life * 0.3;
                } else if (this.type === 'lava') {
                    this.mesh.scale.multiplyScalar(0.98);
                    const color = new THREE.Color();
                    color.setHSL(0.1 - (1 - this.life) * 0.1, 1, 0.5);
                    this.mesh.material.color = color;
                }
                
                if (this.mesh.position.y < 0) {
                    this.mesh.position.y = 0;
                    this.velocity.y *= -0.5;
                    this.velocity.x *= 0.8; this.velocity.z *= 0.8;
                    if (this.type === 'lava' && Math.abs(this.velocity.y) < 1) this.life -= 0.05;
                }
            }
            dispose() { scene.remove(this.mesh); this.mesh.material.dispose(); }
        }

        class Shockwave {
            constructor() {
                const geo = new THREE.RingGeometry(1, 2, 32);
                const mat = new THREE.MeshBasicMaterial({ 
                    color: 0xffaa00, transparent: true, opacity: 0.5, 
                    side: THREE.DoubleSide, blending: THREE.AdditiveBlending 
                });
                this.mesh = new THREE.Mesh(geo, mat);
                this.mesh.rotation.x = -Math.PI / 2;
                this.mesh.position.y = 25;
                scene.add(this.mesh);
                this.scale = 1;
            }
            update() {
                this.scale += 1.5;
                this.mesh.scale.set(this.scale, this.scale, 1);
                this.mesh.material.opacity -= 0.02;
            }
            isDead() { return this.mesh.material.opacity <= 0; }
            dispose() { scene.remove(this.mesh); this.mesh.geometry.dispose(); this.mesh.material.dispose(); }
        }

        // --- 7. ë£¨í”„ & ì´ë²¤íŠ¸ ---
        let shakeIntensity = 0;

        function animate() {
            requestAnimationFrame(animate);
            
            const time = Date.now() * 0.005;
            volcanoLight.intensity = 2 + Math.sin(time) * 1;

            if (Math.random() < 0.3) particles.push(new Particle('smoke'));
            if (Math.random() < 0.05) particles.push(new Particle('lava'));

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i]; p.update();
                if (p.life <= 0) { p.dispose(); particles.splice(i, 1); }
            }
            for (let i = shockwaves.length - 1; i >= 0; i--) {
                const s = shockwaves[i]; s.update();
                if (s.isDead()) { s.dispose(); shockwaves.splice(i, 1); }
            }

            if (shakeIntensity > 0) {
                camera.position.add(new THREE.Vector3((Math.random()-0.5)*shakeIntensity, (Math.random()-0.5)*shakeIntensity, (Math.random()-0.5)*shakeIntensity));
                shakeIntensity *= 0.9;
            }
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        function explode() {
            shakeIntensity = 2.0;
            shockwaves.push(new Shockwave());
            for(let i=0; i<50; i++) particles.push(new Particle('lava'));
            for(let i=0; i<30; i++) particles.push(new Particle('smoke'));
            for(let i=0; i<40; i++) particles.push(new Particle('spark'));
            
            // ë°°ê²½ í”Œë˜ì‹œ íš¨ê³¼ë„ ì•½ê°„ ë” ë°ê²Œ
            const oldBg = scene.background.clone();
            scene.background = new THREE.Color(0x553322);
            setTimeout(() => { scene.background = oldBg; }, 80);
        }

        window.addEventListener('pointerdown', explode);
        window.addEventListener('keydown', (e) => { if(e.code === 'Space') explode(); });

        animate();
    </script>
</body>
</html>
